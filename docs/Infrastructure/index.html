<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Infrastructure  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="Infrastructure  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          Infrastructure Docs
        </a>
         (100% documented)
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/iq3addLi/swift-vapor-layered-realworld-example-app">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">Infrastructure Reference</a>
      <img class="carat" src="img/carat.png" />
      Infrastructure  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Articles.html">Articles</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ArticlesAndAuthorWithFavoritedRow.html">ArticlesAndAuthorWithFavoritedRow</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CommentWithAuthorRow.html">CommentWithAuthorRow</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Comments.html">Comments</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Favorites.html">Favorites</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Follows.html">Follows</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MySQLDatabaseManager.html">MySQLDatabaseManager</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/StandaloneDatabaseConnectionPoolCache.html">StandaloneDatabaseConnectionPoolCache</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/TagOnlyRow.html">TagOnlyRow</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Tags.html">Tags</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/UserWithFollowRow.html">UserWithFollowRow</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Users.html">Users</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Array.html">Array</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/MySQLDatabaseConfig.html">MySQLDatabaseConfig</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/String.html">String</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content">
            
            <p>⚠️   <em>This project is still under development. Several bugs have been confirmed. The development is expected to be completed around December 7th.</em></p>

<p><a href="http://realworld.io"><img src="https://img.shields.io/badge/realworld-backend-%23783578.svg" alt="RealWorld Frontend"></a>  <a href="https://swift.org"><img src="https://img.shields.io/badge/swift-5.1-orange.svg?logo=swift" alt="swift.org"></a>  <a href="https://github.com/vapor/vapor"><img src="http://img.shields.io/badge/%F0%9F%92%A7_vapor-3.3-2196f3.svg" alt="Vapor Documentation"></a>  <a href="https://iq3addli.github.io/swift-vapor-layered-realworld-example-app/docs"><img src="https://img.shields.io/badge/Project&#x27;s_domain-doc-brightgreen.svg" alt="API Doc"></a>  <a href="https://github.com/iq3addLi/riot_v4_realworld_example_app"><img src="https://img.shields.io/badge/Frontend-here-red.svg" alt="My frontend"></a></p>
<h1 id='img-src-logo-png-alt-realworld-example-app' class='heading'><img src="logo.png" alt="RealWorld Example App"></h1>

<blockquote>
<h3 id='vapor-codebase-containing-real-world-examples-crud-auth-advanced-patterns-etc-that-adheres-to-the-a-href-https-github-com-gothinkster-realworld-realworld-a-spec-and-api' class='heading'>Vapor codebase containing real world examples (CRUD, auth, advanced patterns, etc) that adheres to the <a href="https://github.com/gothinkster/realworld">RealWorld</a> spec and API.</h3>
</blockquote>

<p><a href="https://github.com/gothinkster/realworld">Demo</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://github.com/gothinkster/realworld">RealWorld</a> </p>

<p>This codebase was created to demonstrate a fully fledged fullstack application built with <strong>Vapor</strong> including CRUD operations, authentication, routing, pagination, and more.</p>

<p>We&rsquo;ve gone to great lengths to adhere to the <strong>Vapor</strong> community styleguides &amp; best practices.</p>

<p>For more information on how to this works with other frontends/backends, head over to the <a href="https://github.com/gothinkster/realworld">RealWorld</a> repo.</p>

<p>[toc]</p>
<h1 id='how-it-works' class='heading'>How it works</h1>
<h2 id='on-local' class='heading'>On local</h2>
<h3 id='precondition' class='heading'>Precondition</h3>

<ul>
<li>Your platform is Linux or Mac.</li>
<li>Swift 5.1.1 or over than is installed.</li>
<li>Docker is installed.</li>
</ul>
<h3 id='build-realworld-app' class='heading'>Build RealWorld App</h3>
<pre class="highlight shell"><code><span class="nv">$ </span>swift build <span class="nt">-c</span> release 
</code></pre>
<h3 id='launch-container-of-mysql' class='heading'>Launch container of MySQL</h3>
<pre class="highlight shell"><code><span class="nv">$ </span>docker-compose up
</code></pre>
<h3 id='set-environments-for-mysql' class='heading'>Set environments for MySQL</h3>
<pre class="highlight shell"><code><span class="nv">$ </span><span class="nb">export </span><span class="nv">MYSQL_HOSTNAME</span><span class="o">=</span>0.0.0.0
<span class="nv">$ </span><span class="nb">export </span><span class="nv">MYSQL_USERNAME</span><span class="o">=</span>mysqluser
<span class="nv">$ </span><span class="nb">export </span><span class="nv">MYSQL_PASSWORD</span><span class="o">=</span>mysqlpass
<span class="nv">$ </span><span class="nb">export </span><span class="nv">MYSQL_DATABASE</span><span class="o">=</span>mysqldatabase
</code></pre>

<p>This setting values is editable, but it needs to match the setting in <a href="./docker-compose.yml">docker-compose.yml</a>.</p>
<h3 id='launch-realworld-app' class='heading'>Launch RealWorld App</h3>
<pre class="highlight shell"><code><span class="nv">$ </span>.build/release/realworld serve <span class="nt">--hostname</span> 0.0.0.0 <span class="nt">--port</span> 8080
</code></pre>
<h3 id='stop-servers' class='heading'>Stop servers</h3>

<p>By <code>Control + C</code> on launched terminal. Will stop MySQL and App.</p>
<h2 id='on-local-container-for-non-mac' class='heading'>On local container (For non-Mac)</h2>
<h3 id='precondition' class='heading'>Precondition</h3>

<ul>
<li>Docker is installed.</li>
</ul>
<h3 id='build-container-for-realworld-app' class='heading'>Build container for RealWorld App</h3>
<pre class="highlight shell"><code><span class="nv">$ </span>docker build <span class="nt">-t</span> realworld:latest <span class="nb">.</span>
</code></pre>
<h3 id='set-environments-for-mysql' class='heading'>Set environments for MySQL</h3>
<pre class="highlight shell"><code><span class="nv">$ </span><span class="nb">export </span><span class="nv">MYSQL_USERNAME</span><span class="o">=</span>mysqluser
<span class="nv">$ </span><span class="nb">export </span><span class="nv">MYSQL_PASSWORD</span><span class="o">=</span>mysqlpass
<span class="nv">$ </span><span class="nb">export </span><span class="nv">MYSQL_DATABASE</span><span class="o">=</span>mysqldatabase
<span class="nv">$ </span><span class="nb">export </span><span class="nv">MYSQL_ROOTPASS</span><span class="o">=</span>rootpass
</code></pre>

<p>This setting values is editable.  Note that the value set at the beginning is recorded. </p>
<h3 id='launch-container-of-mysql' class='heading'>Launch container of MySQL</h3>
<pre class="highlight shell"><code><span class="nv">$ </span>docker run <span class="se">\</span>
  <span class="nt">--rm</span> <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">MYSQL_USER</span><span class="o">=</span><span class="k">${</span><span class="nv">MYSQL_USERNAME</span><span class="k">}</span><span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">MYSQL_PASSWORD</span><span class="o">=</span><span class="k">${</span><span class="nv">MYSQL_PASSWORD</span><span class="k">}</span><span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">MYSQL_DATABASE</span><span class="o">=</span><span class="k">${</span><span class="nv">MYSQL_DATABASE</span><span class="k">}</span><span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span><span class="k">${</span><span class="nv">MYSQL_ROOTPASS</span><span class="k">}</span><span class="se">\</span>
  <span class="nt">-v</span> <span class="k">${</span><span class="nv">PWD</span><span class="k">}</span>/mysql_data:/var/lib/mysql <span class="se">\</span>
  <span class="nt">-p</span> 3306:3306 <span class="se">\</span>
  mysql:5.7
</code></pre>
<h3 id='check-mysql-address-in-bridge-network-on-docker' class='heading'>Check MySQL address in bridge network on docker</h3>
<pre class="highlight shell"><code><span class="nv">$ </span>docker network inspect bridge | <span class="nb">grep </span>IPv4Address
                <span class="s2">"IPv4Address"</span>: <span class="s2">"172.17.0.2/16"</span>, // example
</code></pre>
<h3 id='launch-container-of-realworld-app' class='heading'>Launch container of RealWorld App</h3>
<pre class="highlight shell"><code><span class="nv">$ </span>docker run <span class="se">\</span>
  <span class="nt">--rm</span> <span class="se">\</span>
  <span class="nt">-p</span> 8080:80 <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">MYSQL_HOSTNAME</span><span class="o">=&lt;&lt;</span><span class="no">host</span><span class="sh"> part of MySQL address&gt;&gt;</span><span class="se">\</span><span class="sh">
  -e MYSQL_USERNAME=</span><span class="k">${</span><span class="nv">MYSQL_USERNAME</span><span class="k">}</span><span class="se">\</span><span class="sh">
  -e MYSQL_PASSWORD=</span><span class="k">${</span><span class="nv">MYSQL_PASSWORD</span><span class="k">}</span><span class="se">\</span><span class="sh">
  -e MYSQL_DATABASE=</span><span class="k">${</span><span class="nv">MYSQL_DATABASE</span><span class="k">}</span><span class="se">\</span><span class="sh">
  realworld:latest
</span></code></pre>

<p><code>Server starting on http://0.0.0.0:80</code>  is displayed. But it opens at <a href="http://0.0.0.0:8080">http://0.0.0.0:8080</a> .</p>
<h3 id='stop-containers' class='heading'>Stop containers</h3>
<pre class="highlight shell"><code><span class="nv">$ </span>docker ps
<span class="nv">$ </span>docker stop <span class="o">&lt;&lt;</span><span class="no">CONTAINER</span><span class="sh"> ID or NAME for MySQL&gt;&gt; &lt;&lt;CONTAINER ID or NAME for RealWorld App&gt;&gt;
</span></code></pre>
<h2 id='on-aws-fargate-by-pulumi' class='heading'>On AWS Fargate by pulumi</h2>
<h3 id='precondition' class='heading'>Precondition</h3>

<ul>
<li>You have AWS and pulumi account.</li>
<li>AWS and Pulumi CLI is Installed.</li>
</ul>
<h3 id='set-environments-for-aws-cli' class='heading'>Set environments for AWS CLI</h3>
<pre class="highlight shell"><code><span class="nv">$ </span><span class="nb">set</span> +o <span class="nb">history</span> <span class="c"># disable record to bash_history </span>
<span class="nv">$ </span><span class="nb">export </span><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=&lt;&lt;</span><span class="no">Your</span><span class="sh"> access key id of AWS account&gt;&gt;
</span><span class="nv">$ </span><span class="sh">export AWS_SECRET_ACCESS_KEY=&lt;&lt;Your access key secret of AWS account&gt;&gt;
</span><span class="nv">$ </span><span class="sh">set -o history
</span><span class="nv">$ </span><span class="sh">clear # flush terminal
</span></code></pre>
<h3 id='preview-pulumi-stack' class='heading'>Preview pulumi stack</h3>
<pre class="highlight shell"><code><span class="nv">$ </span><span class="nb">cd </span>pulumi
<span class="nv">$ </span>pulumi preview
</code></pre>
<h3 id='deploying-pulumi-stack' class='heading'>Deploying pulumi stack</h3>
<pre class="highlight shell"><code><span class="nv">$ </span>pulumi up <span class="nt">--yes</span>
</code></pre>

<p>In this case, the connection settings is listed in <a href="pulumi/Pulumi.dev.yaml">pulumi/Pulumi.dev.yaml</a>. </p>

<p>When processing is complete, the host names for MySQL and APP will be displayed. </p>
<pre class="highlight shell"><code>Outputs:
    appHost  : <span class="s2">"svlre-app-listener-*.us-east-1.elb.amazonaws.com"</span>
    mysqlHost: <span class="s2">"svlre-mysql-listener-*.elb.us-east-1.amazonaws.com"</span>
</code></pre>

<p>Everyone using AWS. I think you know well. <strong>Launched resources are expensive💸</strong>. Clean up resources when you are done.</p>
<h3 id='clean-up-pulumi-stack' class='heading'>Clean up pulumi stack</h3>
<pre class="highlight shell"><code><span class="nv">$ </span>pulumi destroy <span class="nt">--yes</span>
</code></pre>

<p>⚠️ MySQL storage is volatile.</p>
<h1 id='getting-started' class='heading'>Getting started</h1>

<blockquote>
<p><em>Now writing &hellip;</em></p>
</blockquote>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2019 <a class="link" href="https://github.com/iq3addLi/" target="_blank" rel="external">iq3 @ +Li, Inc.</a>. All rights reserved. (Last updated: 2019-12-06)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.12.0</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
